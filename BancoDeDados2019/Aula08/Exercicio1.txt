DROP TABLE DIA;
CREATE TABLE DIA(
  DIA DATE CONSTRAINT DIA_NOT_NULL NOT NULL,
  UTIL NUMBER CONSTRAINT STATUS_NOT_NULL NOT NULL
);

CREATE OR REPLACE PACKAGE CALENDARIO IS 
  FUNCTION DATAS_ENTRE (P_DATA1 IN DATE, P_DATA2 IN DATE) RETURN NUMBER;
  FUNCTION DIA_UTIL (P_DIA IN DATE) RETURN NUMBER;
END CALENDARIO;

CREATE OR REPLACE PACKAGE BODY CALENDARIO IS 
  FUNCTION DATAS_ENTRE (P_DATA1 IN DATE, P_DATA2 IN DATE) RETURN NUMBER IS 
    V_QUANTIDADE NUMBER := 0;
    V_UTIL NUMBER;
    V_DIA_INICIAL DATE := P_DATA1;
    V_DIA_FINAL DATE := P_DATA2;
    BEGIN
    WHILE V_DIA_INICIAL < V_DIA_FINAL LOOP 
      IF TO_CHAR(V_DIA_INICIAL,'d') IN (1,7) THEN
        V_UTIL:= 0;
      ELSE 
        V_UTIL:= 1;
        V_QUANTIDADE:= V_QUANTIDADE +1;
      END IF;
      
      INSERT INTO DIA(DIA,UTIL) VALUES (V_DIA_INICIAL,V_UTIL);
      
      V_DIA_INICIAL:= V_DIA_INICIAL + 1;
    END LOOP;
    RETURN V_QUANTIDADE;
  END;
  
  FUNCTION DIA_UTIL (P_DIA IN DATE) RETURN NUMBER IS 
    V_UTIL NUMBER;
  BEGIN
    SELECT UTIL INTO V_UTIL FROM DIA WHERE DIA = P_DIA;
    RETURN V_UTIL;
  END;
END CALENDARIO;


SELECT * FROM DIA;
DELETE FROM DIA;

DECLARE
  DIAS NUMBER;
BEGIN 
  DIAS := CALENDARIO.DATAS_ENTRE(SYSDATE - 20, SYSDATE);
  DBMS_OUTPUT.PUT_LINE('QUANTIDADE:' || DIAS);
END;